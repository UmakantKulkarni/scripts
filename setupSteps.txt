
cd /opt/scripts && git pull
./gitPullNodes.sh 8 scripts

apt-get update && apt-get -y upgrade && apt-get update
./runNodeCmd.sh "apt-get update && apt-get -y upgrade && apt-get update"  1 2 3 4 5 6 7 8
./runNodeCmd.sh "rm -rf /mnt/*" 0 1 2 3 4 5 6 7 8

curl -L https://git.io/get_helm.sh | bash -s -- --version v3.10.3

ifconfig
./configK8Nodes.sh eno1d1 4 9

source ~/.bashrc

kn
kp
ks
kt
kn
./labelK8sNodes.sh 4 
kn --show-labels

cd /opt/opensource-5g-core/
git pull

cd /opt/scripts/
./nukeOpen5gs.sh


kubectl patch svc amf-open5gs-sctp -n open5gs -p '{"spec": {"type": "LoadBalancer", "externalIPs":["10.10.1.2"]}}'
./deletePod.sh amf

#exec to test pod
cd scripts && git pull
./addMongoSubs.py 2000


#if using standalone mongodb
mongo
use pcs_db
db.amf.drop(); db.smf.drop(); db.upf.drop()


gNBs:
12 - 10.10.1.13
14 - 10.10.1.15

UEs: 
13 - (imsi = 1) - 10.10.1.14
15 - (imsi = 601) - 10.10.1.16

ssh root@node5
cd /opt/UERANSIM/config/open5gs/
#Modify ue and gnb.yaml


ke open5gs-mongodb-0   -- bash -c 'rm -rf /opt/Experiments/*'

kubectl get pods --no-headers=true | awk '/upf|amf|bsf|pcf|udm|ausf|nrf|nssf|udr|smf/{print $1}'| xargs  kubectl delete pod

./runNodeCmd.sh "rm -rf /opt/Experiment* /opt/Node_Ops /opt/Ue_Ops /opt/Udsf_Ops /opt/Results" 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17

./runNodeCmd.sh "find /var/log -type f -delete" 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17


#exec to mongo pod
apt-get update && apt -y install git vim python3-pip
cd scripts && git pull
./mongoMonitor.py  > /dev/null 2>&1 &
ps -ef


#exec to UE nodes
/opt/scripts/launchUeSim.py > /dev/null 2>&1 &
ps -ef | grep Ue


nohup bash runExperiments.sh nonsecure &

nohup bash runExperiments.sh secure &

nohup bash runExperiments.sh noistio &

nohup bash runExperiments.sh udpvpn &

nohup bash runExperiments.sh unsecure &

nohup bash runExperiments.sh ranudpvpn &

nohup bash runExperiments.sh allsecure &

nohup bash runExperiments.sh secore &


Result collection and analysis:

1. Copy Experiment directory from mongo pod to purdue-mc machine in scratch directory:
ke open5gs-mongodb-6bdddb9c4b-twb9t -- bash
scp -r /opt/Experiments ukulkarn@mc21.cs.purdue.edu:/homes/ukulkarn/scratch/


2. Create mongo_op directory in 
cd /proj/sfcs-PG0/opt/
rm -rf *
mkdir mongo_op


3. Reverse copy all mongo files from purdue-mc machine to mongo_op directory:
cd /proj/sfcs-PG0/opt/mongo_op
scp -r ukulkarn@mc21.cs.purdue.edu:/homes/ukulkarn/scratch/Experiments/* .


4. Copy Experiments directory of node0 to /opt/ (To avoid disk space issues):
scp -r /opt/Experiments /opt/


5. Copy top o/p files from other nodes:
cd /opt/scripts
./scpTopOp.sh 11
./scpTopOp.sh 15


6. Copy UE o/p files from other nodes:
cd /opt/scripts
./scpUeOps.sh 13 15


7. Collect all results in single directory:
cd /opt/scripts
./collectResults.sh


8. Generate CSV summary files (Change experimentDirAry as needed):
cd /opt/scripts
./exportToCsv.sh


9. Get CPU and Queue-length analysis files:
cd /opt/scripts
./getCpuVsQueue.sh
./getEnvoyNfCpu.sh


10. Copy CSV files to MAC 
cd PurdueOneDrive/OneDrive\ -\ purdue.edu/Research/Req-Rsp/Experiments/
mkdir Run6
cd Run6
mkdir plotting
cd plotting
scp umakant@ms1222.utah.cloudlab.us:/proj/sfcs-PG0/opt/Results/*-data.csv .


11. Edit CSV files to remove errored experiments 


12. Copy and run plotOverleaf.py against them
scp ../../../../../GitHub/scripts/plotOverleaf.py .
./plotOverleaf.py